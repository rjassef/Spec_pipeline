- Combine OII into a single emission line at the average position of the doublet.

- Include Halpha+NII. This is difficult, as there are really four components to keep track of: the two NII lines, narrow Halpha and broad Halpha. I guess we could just do a single Gaussian each with the correct NII ratio, and just assume a single Halpha. The width of NII would need to be limited to 1000 km/s, but not the width Halpha, to accommodate an offset broad Halpha emission.

- Further in the future: could try to incorporate SPAMM into the mix to use all of those models and fit all (broad+narrow) lines simultaneously, the continuum and the iron emission. 

####

Done


- Implement joint fits for some lines. Easiest is to implement them as
  classes, like an OII class, OIII class, NII_Halpha class, SII class
  for example. For OII, MgII and CIV it is likely we can just get away
  with a single profile for the doublet.

  Actually, easiest will be to have a single joint class that has
  different properties read from a file. It should allow for:

  - Centers with the same or with different velocity shifts.
  - Fixed or variable flux ratios.
  - Same or different widths.

  Try implementing it as N lines.

  Solution: N-lines class implemented.


- Change continuum fit for Lyalpha to be a step function or something
  more sensible than now. SOLUTION: Just used the red continuum side.

- For Palomar, the information was not saved either, but it seems the
  same grating was always used on each side. Solution: Dan confirms
  same setup was always used.


- It seems that the grating information was not preserved for the GMOS
  spectra.  We'll use for now the B600 for everything, but we need to
  Figure this out.

  Solution: Make it a request. We can get the grating list from the
  Gemini archive and then have a lookup table. Not elegant, but will
  work. - Now requested by spec_reader.

- Add more emission lines to the lines.txt file. Lines to fit for:

  OVI/Lyb
  Lya/NV
  CIV
  HeII 1640
  CIII
  CII 2326
  NeIV 2440
  MgII
  OII  3727
  NeIII 3868.74
  Hbeta
  OIII

  Solution: Done


- Setup test run for sky fitting, include moon glow. DONE

- For LRIS eliminate 50A in the borders to avoid dichroic issues. Instead, use dichroic. DONE

- First fit all lines. Use the one with the highest SNR (or all above SNR 25) to fix the velocity shift and only allow shifts of ~500km/s afterwards. This should stop the issues of having very broad, low peak flux emission lines fitting systematics in the continuum. - Actually, after eliminating the dichroic issue above, the error must be better fitted, and these lines stopped appearing at SNR>5. Keep and eye on this however.


- When that is done, setup the fitting such that a "default" spectrum can be loaded at the time when the fitting object is created. The fitting subroutines can still be called with an spec object in the call, but if no spec object is provided, then the default is used. The complication here is that now, for loading the spectrum, we need to provide the line that we want to fit so the correct side can be loaded. - DONE. Now allows user to load a default spectrum when creating the line_fitter object, or to provide it when fitting.

- Include instrumental resolution in line widths.
